var WPF;!function($,e,t,i){"use strict";WPF={prefix:"wpf_",template_type:!1,init:function(e){e=$.extend({prefix:this.prefix,template_type:this.template_type},e),this.prefix=e.prefix,this.template_type=e.template_type,this.Undelegate(),this.bindEvents()},Undelegate:function(){$(t).off("change click")},bindEvents:function(){this.SetupColors(),this.InitDraggable(),this.InitSortable(),this.ShowHide(),this.Unique($("#"+this.prefix+"module_content ."+this.prefix+"back_active_module_content")),this.Open(),this.Delete(),this.Save(),this.ShowThemplates(),this.AddItem(),this.RemmoveItem(),this.multiLanguages(),$.event.trigger("WPF.template_load",this.template_type)},PlaceHoldDragger:function(){$("."+WPF.prefix+"module_holder").each(function(){var e=$(this).find("."+WPF.prefix+"empty_holder_text");0===$(this).find("."+WPF.prefix+"active_module").length?e.show():e.hide()})},InitDraggable:function(){var a=this;$("."+a.prefix+"back_module_panel ."+a.prefix+"back_module").draggable({appendTo:"body",helper:"clone",revert:"invalid",snapMode:"inner",connectToSortable:"."+a.prefix+"module_holder",stop:function(e,t){var i=$(t.helper[0]),n=i.data("type");0<$("#"+a.prefix+"module_content").find('[data-type="'+n+'"]').length&&($("#"+a.prefix+"cmb_"+n).hide(),$.event.trigger("WPF.template_drag_start",[i,t,a.template_type]),a.Unique(i),n=i.find("."+a.prefix+"color_picker"),a.DestroyInputColor(n),a.SetInputColor(n),i.find("."+a.prefix+"toggle_module").trigger("click"),$.event.trigger("WPF.template_drag_end",[i,t,a.template_type]))}})},InitSortable:function(){var i=this;$("."+i.prefix+"module_holder").sortable({placeholder:i.prefix+"ui_state_highlight",items:"."+i.prefix+"back_module",connectWith:"."+i.prefix+"module_holder",cursor:"move",revert:100,axis:"y",cancel:".wpf_active_module",sort:function(e,t){t=t.item.outerHeight();$("."+i.prefix+"module_holder ."+i.prefix+"ui_state_highlight").height(t)},receive:function(e,t){i.PlaceHoldDragger(),$(this).parent().find("."+i.prefix+"empty_holder_text").hide(),$(t.item).removeClass("dragged")},start:function(e,t){$(t.item).removeClass(i.prefix+"dragged")},stop:function(e,t){$(t.item).addClass(i.prefix+"dragged")}}),$("."+i.prefix+"back_active_module_add").sortable({placeholder:i.prefix+"ui_state_highlight",items:"li",connectWith:"parent",cursor:"move",revert:100,axis:"y"})},ShowHide:function(){$("#"+WPF.prefix+"lightbox_container").on("change","."+WPF.prefix+"changed input,."+WPF.prefix+"changed select",function(){var e,t,i,n=!0;$(this).closest("."+WPF.prefix+"show_icons").length&&!$(this).closest("."+WPF.prefix+"items_container").length?(t=$(this).closest("."+WPF.prefix+"show_icons").find("."+WPF.prefix+"items_container"),n=$(this).is(":checked")):0<$(this).closest("."+WPF.prefix+"result_page_wrapper").length&&("wpf_diff_page"==this.id||"wpf_same_page"==this.id)?(t=$(this).closest("."+WPF.prefix+"result_page_wrapper").find("."+WPF.prefix+"result_page_select"),n="diff_page"===$(this).val()):0<$(this).closest("."+WPF.prefix+"grid").length?(t=$("#"+WPF.prefix+"group_fields").closest("."+WPF.prefix+"lightbox_row"),n="vertical"===$(this).val()):0<$(this).closest("."+WPF.prefix+"order").length?(t=$(this).closest("."+WPF.prefix+"order").next("."+WPF.prefix+"orderby"),n="term_order"!==$(this).val()):0<$(this).closest("."+WPF.prefix+"show_range").length?(i=(e=$(this).closest("."+WPF.prefix+"back_active_module_row")).next("."+WPF.prefix+"group"),e=e.nextAll("."+WPF.prefix+"slider"),("group"===$(this).val()?(e.slideUp(),i):(i.slideUp(),e)).slideDown()):0<$(this).closest("."+WPF.prefix+"display_as").length?(t=$(this).closest("."+WPF.prefix+"back_active_module_content").find("."+WPF.prefix+"icons_block"),n="checkbox"===(i=$(this).val())||"radio"===i,"dropdown"===i||"radio"===i?$(this).closest("."+WPF.prefix+"back_active_module_content").find("."+WPF.prefix+"show_all_block").show():$(this).closest("."+WPF.prefix+"back_active_module_content").find("."+WPF.prefix+"show_all_block").hide()):"wpf_pagination_fields"===$(this).prop("id")?(t=$(".wpf_infinity"),n=!$(this).is(":checked")):"pagination_type"===$(this).prop("name")&&("infinity_auto"===$(this).val()?$(".wpf_lightbox_row.wpf_infinity_buffer").show():$(".wpf_lightbox_row.wpf_infinity_buffer").hide()),void 0!==t&&(n?t.slideDown():t.slideUp())}),$("."+WPF.prefix+"changed input:checked,."+WPF.prefix+"changed option:selected").trigger("change")},Open:function(){var r=this;$(t).on("click","."+r.prefix+"toggle_module",function(e){var t=$(this).closest("."+r.prefix+"back_module").find("."+r.prefix+"back_active_module_content");if($(this).hasClass(r.prefix+"opened")||t.is(":visible"))$(this).removeClass(r.prefix+"opened"),t.slideUp();else{$(this).addClass(r.prefix+"opened"),t.slideDown();const i=t.data("type");if("wpf_cat"===i||"wpf_tag"===i){const n=t[0].getElementsByClassName("wpf_tax_items");if(n[0]&&n[0].dataset.url){const a=t[0].querySelector('input[name="['+i+'][color]"]');a.checked?WPF.getTax(n[0]):a.addEventListener("change",function(){WPF.getTax(n[0])},{once:!0})}}}e.preventDefault()})},Delete:function(){$(t).on("click","."+WPF.prefix+"delete_module",function(e){e.preventDefault(),confirm(wpf_js.module_delete)&&(e=$(this).closest("."+WPF.prefix+"back_module"),$("#"+WPF.prefix+"cmb_"+e.data("type")).show(),e.remove(),WPF.PlaceHoldDragger())})},Save:function(){var n=this;$("#"+n.prefix+"submit").on("click",function(e){var t=$(this).closest("form"),i=$("."+n.prefix+"back_builder").find("input,select,textarea");i.prop("disabled",!0),setTimeout(function(){var e=n.ParseData(),e=($.event.trigger("WPF.before_template_save",e),JSON.stringify(e));$("#"+n.prefix+"layout").val(e),$.ajax({url:t.prop("action"),method:"POST",dataType:"json",data:t.serialize(),beforeSend:function(){t.removeClass(n.prefix+"done").addClass(n.prefix+"save")},complete:function(){i.prop("disabled",!1),t.removeClass(n.prefix+"save").addClass(n.prefix+"done")},success:function(e){e&&"1"==e.status&&(t.find("#"+n.prefix+"themplate_id").val(e.id),$("#"+n.prefix+"success_text").html("<p><strong>"+e.text+"</strong></p>").show(),setTimeout(function(){$("#"+n.prefix+"success_text").html("").hide()},2e3),$.event.trigger("WPF.after_template_save"))}})},100),e.preventDefault()})},ParseData:function(){var e=$("#"+WPF.prefix+"module_content"),o={};return e.find("."+WPF.prefix+"back_active_module_content").each(function(){var r=$(this).data("type");o[r]={},$(this).find('input:checked,input[type="text"],input[type="number"],input[type="hidden"],textarea,select').each(function(){var e=$(this).attr("name");if(e){var t=e.split("]");if(t){t.pop();var i,n=[];for(i in t){var a=t[i].split("[");a[1]&&(n[i]=a[1])}(e="arr"==n[2])||o[r][n[1]]&&!n[2]?e?(o[r][n[1]]=$(this).val(),o[r][n[1]]||(o[r][n[1]]=[])):("object"!=typeof o[r][n[0]]&&"object"!=typeof o[r][n[1]]&&(e=o[r][n[1]],o[r][n[1]]=[],o[r][n[1]][0]=e),o[r][n[1]].push($(this).val())):n[2]?(e=n[2],"object"!=typeof o[r][n[1]]&&(o[r][n[1]]={}),o[r][n[1]][e]=$(this).val()):(e=!1,e=$(this).hasClass(WPF.prefix+"color_picker")?!("rgba(0, 0, 0, 1)"==(e=$(this).minicolors("rgbaString"))&&!$(this).val())&&e:"on"==$(this).val()||$(this).val(),o[r][n[1]]=e)}}})}),o},Unique:function(e){e.each(function(){var e,i=$(this),t=(i.find("label").each(function(){var e,t=$(this).attr("for");t&&(t=WPF.Escape($(this).attr("for")),0<$("#"+t).length)&&(e=WPF.GenerateUnique(),i.find("#"+t).attr("id",e),$(this).attr("for",e))}),/.*?\[(.+?)\]/gi),n=i.find('input[type="radio"]'),a={};for(e in n.each(function(e){var t=$(this).attr("name");t&&(a[t]=1)}),a){var r,o,s=e.match(t);s&&(o=WPF.GenerateUnique(),r=i.find('input:radio[name="'+e+'"]'),o=o+s[0]+s[1],r.attr("name",o),i.find('input:radio[name!="'+e+'"]'))&&i.find('input:radio[name="'+o+'"][checked]').prop("checked",!0)}})},GenerateUnique:function(){return WPF.prefix+Math.random().toString(36).substr(2,9)},Escape:function(e){return e.replace(/(:|\.|\[|\]|,)/g,"\\$1")},SetupColors:function(){$("#"+WPF.prefix+"module_content").find("."+WPF.prefix+"color_picker").each(function(){var e=WPF.RgbaToHex($(this).data("value"));e&&-1!==e.indexOf("@")&&(e=e.split("@"),$(this).val(e[0]),$(this).attr("data-opacity",e[1]))}),this.SetInputColor()},SetInputColor:function(e){(e=e||$("."+WPF.prefix+"color_picker")).minicolors({opacity:!0,position:"top right",theme:"default",show:function(){$("."+WPF.prefix+"module_holder").sortable("disable")},hide:function(){$("."+WPF.prefix+"module_holder").sortable("enable")},create:function(e){}})},DestroyInputColor:function(e){(e=e||$("#"+WPF.prefix+"module_content").find("."+WPF.prefix+"color_picker")).minicolors("destroy")},RgbaToHex:function(e){var t;return!!e&&((t=(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(.*)[\s+]?\)/i))&&3<=e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):"")&&e[4]&&(t+="@"+e[4]),t)},ShowThemplates:function(){var n=this.prefix;$(t).on("WPF.close_lightbox",function(e,t){var i;$(t).closest(".wpf_admin_lightbox").find("#"+n+"themplate_id").val()&&(i=$("#the-list"),$.ajax({url:ajaxurl,type:"POST",data:{action:"wpf_get_list"},beforeSend:function(){i.addClass(n+"wait")},complete:function(){i.removeClass(n+"wait")},success:function(e){e&&i.replaceWith($(e).find("#the-list"))}}))})},AddItem:function(){$("#"+WPF.prefix+"module_content").on("click","."+WPF.prefix+"add_item",function(e){e.preventDefault();e=$(this).prev("ul").children("li").first().clone();e.hide().find("input").val(""),$(this).prev("ul").append(e),e.slideDown()})},RemmoveItem:function(){$("#"+WPF.prefix+"module_content").on("click","."+WPF.prefix+"remove_item",function(e){e.preventDefault(),$(this).closest("li").slideUp(function(){$(this).remove()})})},multiLanguages:function(){$("body").on("click",".wpf_language_tabs li",function(e){e.preventDefault();var t,e=$(this);e.hasClass("wpf_active_tab_lng")||(e.siblings(".wpf_active_tab_lng").removeClass("wpf_active_tab_lng"),e.addClass("wpf_active_tab_lng"),(t=e.parents(".wpf_language_tabs").parent().find(".wpf_language_fields")).find("li").removeClass("wpf_active_lng"),t.find('li[data-lng="'+e.children("a").attr("class")+'"]').addClass("wpf_active_lng"))})},getTax:function(t){$.ajax({url:t.dataset.url,success:function(e){e&&(t.innerHTML=e,t.dataset.url="",WPF.multiLanguages(),WPF.SetupColors())}})}}}(jQuery,window,document);